<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='Step 1: Create your Digital Ocean droplet Make sure you add your SSH when creating digital ocean and do not add a paraphrase to your SSH. It doesn‚Äôt work with paraphrase.
Step 2: Setting up your server (DO droplet) Log into your server. 1 ssh root@134.209.8.141 Setup VIM as default editor on your server. 1 sudo update-alternatives --config editor Make sure you select the /usr/bin/vim.basic option which is number 3.'>
<title>Elixir Phoenix 1.4 Deployments with Distillery and Edeliver on Ubuntu</title>

<link rel='canonical' href='https://mythicalprogrammer.github.io/p/elixir-phoenix-deploy-distillery-and-edeliver/'>

<link rel="stylesheet" href="/scss/style.min.ae544f6e875175eb0f852537f03e029a61665cc22ad0fd93bf333e7c3bee5a8c.css"><meta property='og:title' content='Elixir Phoenix 1.4 Deployments with Distillery and Edeliver on Ubuntu'>
<meta property='og:description' content='Step 1: Create your Digital Ocean droplet Make sure you add your SSH when creating digital ocean and do not add a paraphrase to your SSH. It doesn‚Äôt work with paraphrase.
Step 2: Setting up your server (DO droplet) Log into your server. 1 ssh root@134.209.8.141 Setup VIM as default editor on your server. 1 sudo update-alternatives --config editor Make sure you select the /usr/bin/vim.basic option which is number 3.'>
<meta property='og:url' content='https://mythicalprogrammer.github.io/p/elixir-phoenix-deploy-distillery-and-edeliver/'>
<meta property='og:site_name' content='Anthony Quoc Anh Doan - Ramblings of a Happy Scientist'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='Elixir' /><meta property='article:tag' content='Phoenix' /><meta property='article:tag' content='webdev' /><meta property='article:tag' content='deployment' /><meta property='article:tag' content='distillery' /><meta property='article:tag' content='edeliver' /><meta property='article:published_time' content='2019-09-16T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2019-09-16T00:00:00&#43;00:00'/><meta property='og:image' content='https://mythicalprogrammer.github.io/p/elixir-phoenix-deploy-distillery-and-edeliver/color-1544543_1280.jpg' />
<meta name="twitter:site" content="@AnthonyDoan20">
    <meta name="twitter:creator" content="@AnthonyDoan20"><meta name="twitter:title" content="Elixir Phoenix 1.4 Deployments with Distillery and Edeliver on Ubuntu">
<meta name="twitter:description" content="Step 1: Create your Digital Ocean droplet Make sure you add your SSH when creating digital ocean and do not add a paraphrase to your SSH. It doesn‚Äôt work with paraphrase.
Step 2: Setting up your server (DO droplet) Log into your server. 1 ssh root@134.209.8.141 Setup VIM as default editor on your server. 1 sudo update-alternatives --config editor Make sure you select the /usr/bin/vim.basic option which is number 3."><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://mythicalprogrammer.github.io/p/elixir-phoenix-deploy-distillery-and-edeliver/color-1544543_1280.jpg' />
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hud04d226d349438d5d6dbe19a25343199_44779_300x0_resize_box_3.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">üç•</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Anthony Quoc Anh Doan - Ramblings of a Happy Scientist</a></h1>
            <h2 class="site-description">An instrument of peace. Where there is hatred, let me sow love; where there is doubt, let&#39;s get some data and build a model.</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='https://github.com/mythicalprogrammer'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://www.linkedin.com/in/anthony-anh-quoc-doan-a7234321/'
                        target="_blank"
                        title="LinkedIn"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-linkedin" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z" />
  <path d="M8 11l0 5" />
  <path d="M8 8l0 .01" />
  <path d="M12 16l0 -5" />
  <path d="M16 16v-3a2 2 0 0 0 -4 0" />
</svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://mastodon.social/@anthony_doan'
                        target="_blank"
                        title="Mastodon"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-mastodon" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M18.648 15.254c-1.816 1.763 -6.648 1.626 -6.648 1.626a18.262 18.262 0 0 1 -3.288 -.256c1.127 1.985 4.12 2.81 8.982 2.475c-1.945 2.013 -13.598 5.257 -13.668 -7.636l-.026 -1.154c0 -3.036 .023 -4.115 1.352 -5.633c1.671 -1.91 6.648 -1.666 6.648 -1.666s4.977 -.243 6.648 1.667c1.329 1.518 1.352 2.597 1.352 5.633s-.456 4.074 -1.352 4.944z" />
  <path d="M12 11.204v-2.926c0 -1.258 -.895 -2.278 -2 -2.278s-2 1.02 -2 2.278v4.722m4 -4.722c0 -1.258 .895 -2.278 2 -2.278s2 1.02 2 2.278v4.722" />
</svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://www.reddit.com/user/anthony_doan/'
                        target="_blank"
                        title="Reddit"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-reddit" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M12 8c2.648 0 5.028 .826 6.675 2.14a2.5 2.5 0 0 1 2.326 4.36c0 3.59 -4.03 6.5 -9 6.5c-4.875 0 -8.845 -2.8 -9 -6.294l-1 -.206a2.5 2.5 0 0 1 2.326 -4.36c1.646 -1.313 4.026 -2.14 6.674 -2.14z" />
  <path d="M12 8l1 -5l6 1" />
  <path d="M19 4m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
  <circle cx="9" cy="13" r=".5" fill="currentColor" />
  <circle cx="15" cy="13" r=".5" fill="currentColor" />
  <path d="M10 17c.667 .333 1.333 .5 2 .5s1.333 -.167 2 -.5" />
</svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://stackoverflow.com/users/339405/mythicalprogrammer'
                        target="_blank"
                        title="StackOverflow"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-stackoverflow" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 17v1a2 2 0 0 0 2 2h12a2 2 0 0 0 2 -2v-1" />
  <path d="M8 16h8" />
  <path d="M8.322 12.582l7.956 .836" />
  <path d="M8.787 9.168l7.826 1.664" />
  <path d="M10.096 5.764l7.608 2.472" />
</svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com/AnthonyDoan20'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about-me/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About Me</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        
        <li >
            <a href='/portfolio' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-folder-star" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M10 19h-5a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 2 -2h4l3 3h7a2 2 0 0 1 2 2v2.5" />
  <path d="M17.8 20.817l-2.172 1.138a.392 .392 0 0 1 -.568 -.41l.415 -2.411l-1.757 -1.707a.389 .389 0 0 1 .217 -.665l2.428 -.352l1.086 -2.193a.392 .392 0 0 1 .702 0l1.086 2.193l2.428 .352a.39 .39 0 0 1 .217 .665l-1.757 1.707l.414 2.41a.39 .39 0 0 1 -.567 .411l-2.172 -1.138z" />
</svg>
                
                <span>Portfolio</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>Dark Mode</span>
                </li>
            
        </div>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#step-1-create-your-digital-ocean-droplet">Step 1: Create your Digital Ocean droplet</a></li>
    <li><a href="#step-2-setting-up-your-server-do-droplet">Step 2: Setting up your server (DO droplet)</a>
      <ol>
        <li><a href="#log-into-your-server">Log into your server.</a></li>
        <li><a href="#setup-vim-as-default-editor-on-your-server">Setup VIM as default editor on your server.</a></li>
        <li><a href="#update-your-locale">Update your locale.</a></li>
        <li><a href="#create-new-deploy-user">Create new deploy user</a></li>
        <li><a href="#add-deploy-to-sudoers">Add deploy to sudoers</a></li>
        <li><a href="#add-ssh-public-key-to-authorized_keys">Add ssh public key to authorized_keys</a></li>
        <li><a href="#set-up-your-firewall-on-ubuntu">Set up your firewall on Ubuntu</a></li>
      </ol>
    </li>
    <li><a href="#step-3-target-server---install-asdf">Step 3: Target Server - Install asdf</a>
      <ol>
        <li><a href="#install-asdf">Install asdf</a></li>
        <li><a href="#optional-step-if-you-are-on-5-digital-ocean-droplet">Optional step if you are on $5 Digital Ocean Droplet</a>
          <ol>
            <li><a href="#create-swap-file">Create swap file.</a></li>
            <li><a href="#enabling-the-swap-file">Enabling the swap file</a></li>
            <li><a href="#making-the-swapfile-permanent">Making the swapfile permanent</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#step-4-target-server---install-erlangelixir">Step 4: Target Server - Install Erlang/Elixir</a>
      <ol>
        <li><a href="#install-erlang">Install Erlang</a></li>
        <li><a href="#install-elixir">Install Elixir</a></li>
      </ol>
    </li>
    <li><a href="#step-5-target-server---install-nodejs">Step 5: Target Server - Install Nodejs</a></li>
    <li><a href="#step-6-target-server---install-postgresql">Step 6: Target Server - Install Postgresql</a>
      <ol>
        <li><a href="#install-postgresql-11-on-ubuntu-1804--ubuntu-1604">Install PostgreSQL 11 on Ubuntu 18.04 / Ubuntu 16.04</a></li>
        <li><a href="#create-new-database-user">Create new database user</a></li>
        <li><a href="#create-production-database">Create production database:</a></li>
        <li><a href="#database-credentials">Database credentials:</a></li>
      </ol>
    </li>
    <li><a href="#step-7-target-server---production-configuration">Step 7: Target Server - Production Configuration</a>
      <ol>
        <li><a href="#create-prodsecretexs">Create <code>prod.secret.exs</code></a></li>
      </ol>
    </li>
    <li><a href="#step-8-install-distillery-and-edeliver">Step 8: Install Distillery and edeliver</a>
      <ol>
        <li><a href="#initialize-distillery">Initialize Distillery</a></li>
        <li><a href="#configure-edeliver">Configure edeliver</a></li>
        <li><a href="#project-prod-configuration">Project prod configuration</a></li>
        <li><a href="#add-env-variables-to-target-server">Add env Variables to Target Server</a></li>
      </ol>
    </li>
    <li><a href="#step-9-deployment">Step 9: Deployment</a>
      <ol>
        <li><a href="#build-the-production-release">Build the production release:</a></li>
        <li><a href="#deploy-the-reload-to-production">Deploy the reload to production:</a></li>
        <li><a href="#view-our-website-on-our-server">View our website on our server</a></li>
      </ol>
    </li>
    <li><a href="#step-10-generating-ssl-cert---before-routing-incoming-http-request-to-port-4000-our-phoenix-app">Step 10: Generating SSL CERT - BEFORE Routing incoming http request to port 4000 (our phoenix app)</a>
      <ol>
        <li><a href="#step-1--installing-certbot">Step 1 ‚Äî Installing Certbot</a></li>
        <li><a href="#step-2--generating-certificate">Step 2 ‚Äî Generating Certificate</a></li>
      </ol>
    </li>
    <li><a href="#step-11-routing-incoming-http-request-to-port-4000-our-phoenix-app">Step 11: Routing incoming http request to port 4000 (our phoenix app)</a></li>
    <li><a href="#step-12-fail2ban">Step 12: Fail2ban</a>
      <ol>
        <li><a href="#testing-and-unbanning">Testing and unbanning</a></li>
        <li><a href="#scratching-the-surface">Scratching the surface</a></li>
      </ol>
    </li>
    <li><a href="#step-13-port-foward-ssl-to-port-4001">Step 13: Port foward SSL to Port 4001</a></li>
    <li><a href="#step-14-ssl">Step 14: SSL</a>
      <ol>
        <li><a href="#step-1--generating-diffie-hellman-parameters">Step 1 ‚Äî Generating Diffie Hellman parameters</a></li>
        <li><a href="#step-2--set-up-your-environment">Step 2 ‚Äî Set up your environment</a></li>
        <li><a href="#step-3--prod-configuration">Step 3 ‚Äî prod Configuration</a></li>
        <li><a href="#step-4--application-configuration-forcing-ssl">Step 4 ‚Äî Application Configuration forcing SSL</a></li>
        <li><a href="#step-5--increasing-the-security-of-ssl">Step 5 ‚Äî Increasing the security of SSL</a></li>
      </ol>
    </li>
    <li><a href="#credit">Credit</a>
      <ol>
        <li><a href="#base-on-these-resources">Base on these resources:</a></li>
        <li><a href="#pictures">Pictures</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/elixir-phoenix-deploy-distillery-and-edeliver/">
                <img src="/p/elixir-phoenix-deploy-distillery-and-edeliver/color-1544543_1280_hu03f7c0de7591ec620ffda9d2135553d8_169172_800x0_resize_q75_box.jpg"
                        srcset="/p/elixir-phoenix-deploy-distillery-and-edeliver/color-1544543_1280_hu03f7c0de7591ec620ffda9d2135553d8_169172_800x0_resize_q75_box.jpg 800w, /p/elixir-phoenix-deploy-distillery-and-edeliver/color-1544543_1280_hu03f7c0de7591ec620ffda9d2135553d8_169172_1600x0_resize_q75_box.jpg 1600w"
                        width="800" 
                        height="692" 
                        loading="lazy"
                        alt="Featured image of post Elixir Phoenix 1.4 Deployments with Distillery and Edeliver on Ubuntu" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/web-development/" >
                Web Development
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/elixir-phoenix-deploy-distillery-and-edeliver/">Elixir Phoenix 1.4 Deployments with Distillery and Edeliver on Ubuntu</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Sep 16, 2019</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    23 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h2 id="step-1-create-your-digital-ocean-droplet">Step 1: Create your Digital Ocean droplet</h2>
<p>Make sure you add your SSH when creating digital ocean and do not add a paraphrase to your SSH. It doesn‚Äôt work with paraphrase.</p>
<h2 id="step-2-setting-up-your-server-do-droplet">Step 2: Setting up your server (DO droplet)</h2>
<h3 id="log-into-your-server">Log into your server.</h3>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> ssh root@134.209.8.141
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="setup-vim-as-default-editor-on-your-server">Setup VIM as default editor on your server.</h3>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> sudo update-alternatives --config editor
</span></span></code></pre></td></tr></table>
</div>
</div><p>Make sure you select the <code>/usr/bin/vim.basic</code> option which is number 3.</p>
<h3 id="update-your-locale">Update your locale.</h3>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> sudo update-locale <span style="color:#268bd2">LC_ALL</span><span style="color:#719e07">=</span>en_US.UTF-8
</span></span><span style="display:flex;"><span> sudo update-locale <span style="color:#268bd2">LANGUAGE</span><span style="color:#719e07">=</span>en_US.UTF-8
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="create-new-deploy-user">Create new deploy user</h3>
<p>The next step is to create a non-root user on the server which will own our application and handle deployments. We‚Äôll configure the .ssh directory for the user, configure the user to have passwordless sudo access, and disabled password login to harden the server a bit.</p>
<p>Let‚Äôs create the user <code>deploy</code>.</p>
<p>As <code>root</code> on the target server:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> adduser deploy
</span></span></code></pre></td></tr></table>
</div>
</div><p>Fill out the data as required. Like password.</p>
<p>Next, run this series of commands to configure the user‚Äôs <code>.ssh</code>   directory:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> sudo mkdir -p /home/deploy/.ssh
</span></span><span style="display:flex;"><span> sudo touch /home/deploy/.ssh/authorized_keys
</span></span><span style="display:flex;"><span> sudo chmod <span style="color:#2aa198">700</span> /home/deploy/.ssh
</span></span><span style="display:flex;"><span> sudo chmod <span style="color:#2aa198">644</span> /home/deploy/.ssh/authorized_keys
</span></span><span style="display:flex;"><span> sudo chown -R deploy:deploy /home/deploy
</span></span></code></pre></td></tr></table>
</div>
</div><p>As <code>root</code> on the target server:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> sudo vim /etc/ssh/sshd_config
</span></span></code></pre></td></tr></table>
</div>
</div><p>Verify that password authentication is set to ‚Äúno‚Äù:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> PasswordAuthentication no
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="add-deploy-to-sudoers">Add deploy to sudoers</h3>
<p>Finally we&rsquo;ll add the user to sudo.</p>
<p>As <code>root</code> on the target machine:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> visudo
</span></span></code></pre></td></tr></table>
</div>
</div><p>This will open the sudoers file where we can add the <code>deploy</code> users privileges below <code>root</code> like this:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#586e75"># User privilege specification</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> root <span style="color:#268bd2">ALL</span><span style="color:#719e07">=(</span>ALL:ALL<span style="color:#719e07">)</span> ALL
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> deploy <span style="color:#268bd2">ALL</span><span style="color:#719e07">=(</span>ALL<span style="color:#719e07">)</span> NOPASSWD: ALL
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="add-ssh-public-key-to-authorized_keys">Add ssh public key to authorized_keys</h3>
<p>In another terminal window, on your local machine:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> cat ~/.ssh/id_rsa.pub
</span></span></code></pre></td></tr></table>
</div>
</div><p>On the target server, paste the key into authorized_keys:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> sudo vim /home/deploy/.ssh/authorized_keys
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now we can safely log in and work as the <code>deploy</code> user on the target machine without having to enter a password.</p>
<p>Now go to Basic Hardening article to remove <code>root</code> login.</p>
<h3 id="set-up-your-firewall-on-ubuntu">Set up your firewall on Ubuntu</h3>
<p>source/credit: <a class="link" href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-18-04"  target="_blank" rel="noopener"
    >https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-18-04</a></p>
<p>Ubuntu 18.04 servers can use the UFW firewall to make sure only connections to certain services are allowed. We can set up a basic firewall very easily using this application.</p>
<p>Different applications can register their profiles with UFW upon installation. These profiles allow UFW to manage these applications by name. OpenSSH, the service allowing us to connect to our server now, has a profile registered with UFW.</p>
<p>You can see this by typing:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> ufw app list
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Available applications:
</span></span><span style="display:flex;"><span>  OpenSSH
</span></span></code></pre></td></tr></table>
</div>
</div><p>We need to make sure that the firewall allows SSH connections so that we can log back in next time. We can allow these connections by typing:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> ufw allow OpenSSH
</span></span></code></pre></td></tr></table>
</div>
</div><p>Afterwards, we can enable the firewall by typing:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> ufw <span style="color:#b58900">enable</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Type ‚Äú<code>y</code>‚Äù and press <code>ENTER</code> to proceed. You can see that SSH connections are still allowed by typing:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> ufw status
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> Status: active
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>To                         Action      From
</span></span><span style="display:flex;"><span>--                         ------      ----
</span></span><span style="display:flex;"><span>OpenSSH                    ALLOW       Anywhere
</span></span><span style="display:flex;"><span>OpenSSH <span style="color:#719e07">(</span>v6<span style="color:#719e07">)</span>               ALLOW       Anywhere <span style="color:#719e07">(</span>v6<span style="color:#719e07">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>As <em>the firewall is currently blocking all connections except for SSH</em>, if you install and configure additional services, you will need to adjust the firewall settings to allow acceptable traffic in. You can learn some common UFW operations in <a class="link" href="https://www.digitalocean.com/community/tutorials/ufw-essentials-common-firewall-rules-and-commands"  target="_blank" rel="noopener"
    >this guide</a>.</p>
<h2 id="step-3-target-server---install-asdf">Step 3: Target Server - Install asdf</h2>
<p>Sometimes, you‚Äôll need to install specific versions or Erlang, Elixir or Node, and we‚Äôll use <a class="link" href="https://github.com/asdf-vm/asdf"  target="_blank" rel="noopener"
    >asdf</a>, a version manager to tackle this complex task.</p>
<p><code>asdf</code> is an extendable version manager with support for Ruby, Node.js, Elixir, Erlang &amp; more.</p>
<p>To install it, we‚Äôll first switch over to our newly created <code>deploy</code> user.</p>
<p>On the target server as <code>root</code>:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> $ su deploy
</span></span><span style="display:flex;"><span> $ <span style="color:#b58900">cd</span> <span style="color:#586e75"># move into deploy&#39;s home path</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="install-asdf">Install asdf</h3>
<p>Install dependencies:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo add-apt-repository <span style="color:#2aa198">&#34;deb http://archive.ubuntu.com/ubuntu </span><span style="color:#719e07">$(</span>lsb_release -sc<span style="color:#719e07">)</span><span style="color:#2aa198"> main universe restricted multiverse&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sudo add-apt-repository <span style="color:#2aa198">&#34;deb http://archive.ubuntu.com/ubuntu </span><span style="color:#719e07">$(</span>lsb_release -sc<span style="color:#719e07">)</span><span style="color:#2aa198"> universe&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sudo apt-get update
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sudo apt-get install -y build-essential git wget libssl-dev libreadline-dev <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>  libncurses5-dev zlib1g-dev m4 curl wx-common libwxgtk3.0-dev autoconf <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>  libxml2-utils xsltproc fop unixodbc unixodbc-bin unixodbc-dev
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sudo apt-get install openjdk-8-jdk
</span></span><span style="display:flex;"><span>sudo apt-get autoremove
</span></span><span style="display:flex;"><span>sudo apt-get upgrade
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ensure that you are using the deploy account, and clone the repo:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> git clone https://github.com/asdf-vm/asdf.git ~/.asdf
</span></span></code></pre></td></tr></table>
</div>
</div><p>After this you need to add asdf to your <code>deploy</code> user bash profile:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#b58900">cd</span> ~
</span></span><span style="display:flex;"><span> vim ~/.profile
</span></span></code></pre></td></tr></table>
</div>
</div><p>Add this at the end of your profile:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> . <span style="color:#268bd2">$HOME</span>/.asdf/asdf.sh
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="optional-step-if-you-are-on-5-digital-ocean-droplet">Optional step if you are on $5 Digital Ocean Droplet</h3>
<p>For $5 droplet, asdf only works if you create a swapspace (I set it to 4GB) and wait a bit for asdf to install and build erlang felt like 30 min. See solution: (<a class="link" href="https://www.digitalocean.com/community/tutorials/how-to-add-swap-space-on-ubuntu-18-04"  target="_blank" rel="noopener"
    >https://www.digitalocean.com/community/tutorials/how-to-add-swap-space-on-ubuntu-18-04</a>) See the problem reported: (<a class="link" href="https://github.com/asdf-vm/asdf-erlang/issues/91"  target="_blank" rel="noopener"
    >https://github.com/asdf-vm/asdf-erlang/issues/91</a>)</p>
<p>Switch to root to create swap space.</p>
<p>We can see if the system has any configured swap by typing:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> sudo swapon --show
</span></span></code></pre></td></tr></table>
</div>
</div><p>You can verify that there is no active swap using the <code>free</code> utility:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> free -h
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="create-swap-file">Create swap file.</h4>
<p>The size of swap file is usually double your ram. But do 4G minimum.</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> sudo fallocate -l 4G /swapfile
</span></span></code></pre></td></tr></table>
</div>
</div><p>We can verify that the correct amount of space was reserved by typing:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>  ls -lh /swapfile
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="enabling-the-swap-file">Enabling the swap file</h4>
<p>Now that we have a file of the correct size available, we need to actually turn this into swap space.</p>
<p>First, we need to lock down the permissions of the file so that only the users with <code>root</code> privileges can read the contents. This prevents normal users from being able to access the file, which would have significant security implications.</p>
<p>Make the file only accessible to <code>root</code> by typing:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> sudo chmod <span style="color:#2aa198">600</span> /swapfile
</span></span></code></pre></td></tr></table>
</div>
</div><p>Verify the permissions change by typing:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> ls -lh /swapfile
</span></span></code></pre></td></tr></table>
</div>
</div><p>As you can see, only the <code>root</code> user has the read and write flags enabled.</p>
<p>We can now mark the file as swap space by typing:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> sudo mkswap /swapfile
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Setting up swapspace version 1, <span style="color:#268bd2">size</span> <span style="color:#719e07">=</span> <span style="color:#2aa198">1024</span> MiB <span style="color:#719e07">(</span><span style="color:#2aa198">1073737728</span> bytes<span style="color:#719e07">)</span>
</span></span><span style="display:flex;"><span>no label, <span style="color:#268bd2">UUID</span><span style="color:#719e07">=</span>6e965805-2ab9-450f-aed6-577e74089dbf
</span></span></code></pre></td></tr></table>
</div>
</div><p>After marking the file, we can enable the swap file, allowing our system to start utilizing it:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> sudo swapon /swapfile
</span></span></code></pre></td></tr></table>
</div>
</div><p>Verify that the swap is available by typing:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> sudo swapon --show
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="making-the-swapfile-permanent">Making the swapfile permanent</h4>
<p>Our recent changes have enabled the swap file for the current session. However, if we reboot, the server will not retain the swap settings automatically. We can change this by adding the swap file to our <code>/etc/fstab</code> file.</p>
<p>Back up the <code>/etc/fstab</code> file in case anything goes wrong:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> sudo cp /etc/fstab /etc/fstab.bak 
</span></span></code></pre></td></tr></table>
</div>
</div><p>Add the swap file information to the end of your <code>/etc/fstab</code> file by typing:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#b58900">echo</span> <span style="color:#2aa198">&#39;/swapfile none swap sw 0 0&#39;</span> | sudo tee -a /etc/fstab
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now switch to deploy user and check to see if asdf by typing <code>asdf</code>.</p>
<h2 id="step-4-target-server---install-erlangelixir">Step 4: Target Server - Install Erlang/Elixir</h2>
<p>Because we need our Phoenix project to run on both the local development machine and the production server, we‚Äôll need to install the same languages and tools in both places. Erlang 21.1, and Elixir 1.7.4.</p>
<h3 id="install-erlang">Install Erlang</h3>
<p>We‚Äôre going to use <code>asdf</code> to install Erlang. I uses plugins for different libraries, so let‚Äôs add the plugin:</p>
<p>As <code>deploy</code> on the target machine:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> asdf plugin-add erlang
</span></span></code></pre></td></tr></table>
</div>
</div><p>Install Erlang/OTP 22 (or whichever version your app needs)</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>asdf install erlang 22.0
</span></span><span style="display:flex;"><span>asdf global erlang 22.0
</span></span></code></pre></td></tr></table>
</div>
</div><p>OPTIONAL If anything went wrong or if dependencies skipped</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> asdf plugin-remove erlang
</span></span><span style="display:flex;"><span> asdf plugin-remove elixir
</span></span><span style="display:flex;"><span> asdf plugin-add erlang
</span></span><span style="display:flex;"><span> asdf plugin-add elixir
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="install-elixir">Install Elixir</h3>
<p>As <code>deploy</code> add the plugin:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> asdf plugin-add elixir
</span></span></code></pre></td></tr></table>
</div>
</div><p>Install Elixir and make it global:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> asdf install elixir 1.8.2
</span></span><span style="display:flex;"><span> asdf global elixir 1.8.2
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now you can open a new terminal and try <code>erl</code>:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> erl
</span></span></code></pre></td></tr></table>
</div>
</div><p>And you can try <code>iex</code>:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> iex
</span></span></code></pre></td></tr></table>
</div>
</div><p>Use <code>asdf .tool-versions</code> file to manage which version is active on each of your projects.</p>
<p>Use <code>Mix</code> to install <code>Hex</code>.</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>  mix local.hex
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="step-5-target-server---install-nodejs">Step 5: Target Server - Install Nodejs</h2>
<p>Installing Node is straightforward with a few commands.</p>
<p><em>NOTE</em>: Look up what NODE version to install. Replace XX with version number such as 12. see <a class="link" href="https://github.com/nodesource/distributions/blob/master/README.md"  target="_blank" rel="noopener"
    >https://github.com/nodesource/distributions/blob/master/README.md</a></p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> sudo apt install curl
</span></span><span style="display:flex;"><span> curl -sL https://deb.nodesource.com/setup_XX.x | sudo -E bash -
</span></span><span style="display:flex;"><span> sudo apt-get install -y nodejs
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="step-6-target-server---install-postgresql">Step 6: Target Server - Install Postgresql</h2>
<p>base on <a class="link" href="https://computingforgeeks.com/install-postgresql-11-on-ubuntu-18-04-ubuntu-16-04/"  target="_blank" rel="noopener"
    >https://computingforgeeks.com/install-postgresql-11-on-ubuntu-18-04-ubuntu-16-04/</a></p>
<p>As <code>root</code> on the target server:</p>
<p>Add PostgreSQL 11 APT repository (for Bionic 18.04 ubuntu)</p>
<p><a class="link" href="https://www.postgresql.org/download/linux/ubuntu/"  target="_blank" rel="noopener"
    >https://www.postgresql.org/download/linux/ubuntu/</a></p>
<p>Create the file <code>/etc/apt/sources.list.d/pgdg</code> list and add a line for the repository.</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> sudo vim /etc/apt/sources.list.d/pgdg.list
</span></span></code></pre></td></tr></table>
</div>
</div><p>Add this line:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> deb http://apt.postgresql.org/pub/repos/apt/ bionic-pgdg main
</span></span></code></pre></td></tr></table>
</div>
</div><p>Import the repository signing key, and update the package lists :</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc |     sudo apt-key add -
</span></span><span style="display:flex;"><span> sudo apt-get update
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="install-postgresql-11-on-ubuntu-1804--ubuntu-1604">Install PostgreSQL 11 on Ubuntu 18.04 / Ubuntu 16.04</h3>
<p>After importing GPG key, add repository contents to your Ubuntu 18.04/16.04 system:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> sudo apt-get install postgresql-11
</span></span></code></pre></td></tr></table>
</div>
</div><p>Verify repository file contents</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> cat /etc/apt/sources.list.d/pgdg.list
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="create-new-database-user">Create new database user</h3>
<p>During the postgres installation, a postgres root user <code>postgres</code> was created, but we don‚Äôt want to connect to the server with this user. Let‚Äôs create a separate postgres user for our app.</p>
<p>You can switch to the postgres user with <code>su postgres</code> than back to root with exit</p>
<p>On the target server, switch to the <code>postgres</code> user, create a <code>phx</code> database user and set the new user‚Äôs password:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> $ su postgres
</span></span><span style="display:flex;"><span> $ <span style="color:#b58900">cd</span> ~
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> $ createuser phx --pwprompt
</span></span><span style="display:flex;"><span> Enter password <span style="color:#719e07">for</span> new role: 
</span></span><span style="display:flex;"><span> Enter it again:
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>NOTE</em>: Remember these credentials as they‚Äôll be used once we configure our Phoenix application for production.</p>
<h3 id="create-production-database">Create production database:</h3>
<p>We‚Äôll need to create our production database manually as edeliver only manages migrations.</p>
<p>As <code>postgres</code> on the target server:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> createdb fumigate_prod
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then log in to <code>psql</code>:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> psql
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ensure that you are logged into the postgres cli tool and run:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> GRANT ALL PRIVILEGES ON DATABASE fumigate_prod TO phx;
</span></span></code></pre></td></tr></table>
</div>
</div><p>This gives our new <code>phx</code> user access to the newly created database. Exit psql with <code>\q</code>.</p>
<h3 id="database-credentials">Database credentials:</h3>
<p>To re-cap:</p>
<ul>
<li>username: <code>phx</code></li>
<li>password: <code>&lt;yourpass&gt;</code></li>
<li>database: <code>fumigate_prod</code></li>
</ul>
<h2 id="step-7-target-server---production-configuration">Step 7: Target Server - Production Configuration</h2>
<h3 id="create-prodsecretexs">Create <code>prod.secret.exs</code></h3>
<p>You may have noticed that Phoenix created a <code>config/prod.secret.exs</code> file. This is imported by <code>config/prod.exs</code> but is ignored by git by default. We‚Äôll need to create this file on the target machine so edeliver can symlink to it during the build process.</p>
<p>We‚Äôre also going to store our applications in <code>~/apps/&lt;appname&gt;</code> format which is the equivalent of <code>/home/deploy/apps/&lt;appname&gt;</code>.</p>
<p>Let‚Äôs switch over to our <code>deploy</code> user. On the target machine:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> su deploy
</span></span><span style="display:flex;"><span> <span style="color:#b58900">cd</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Make a new directory for our secrets:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> mkdir -p apps/fumigate/secret
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then create a new <code>prod.secret.exs</code> file in that directory:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> vim ~/apps/fumigate/secret/prod.secret.exs
</span></span></code></pre></td></tr></table>
</div>
</div><p>Add this content to it:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> use Mix.Config
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>config :fumigate, FumigateWeb.Endpoint,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> secret_key_base: <span style="color:#2aa198">&#34;YOURKEYHERE+v7fAdFNvoSZpUwTU96jA0UjEF1sgiVwdI5F&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>config :fumigate, Fumigate.Repo,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> username: <span style="color:#2aa198">&#34;phx&#34;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> password: <span style="color:#2aa198">&#34;yourpassword&#34;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> database: <span style="color:#2aa198">&#34;fumigate_prod&#34;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> pool_size: <span style="color:#2aa198">15</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>You can generate a new secret key by using <code>mix phx.gen.secret</code> on your local machine.</p>
<p><em>IMPORTANT</em>: Update the file to have a production ready secret key, and the database credentials you set from earlier.</p>
<h2 id="step-8-install-distillery-and-edeliver">Step 8: Install Distillery and edeliver</h2>
<p>As previously mentioned, <a class="link" href="https://github.com/bitwalker/distillery"  target="_blank" rel="noopener"
    >Distillery</a> compiles our Phoenix application into releases, and edeliver uses ssh and scp to build and deploy the releases to our production server.</p>
<p>On your local machine, open <code>mix.exs</code> and add 2 deps:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#719e07">{</span>:edeliver, <span style="color:#2aa198">&#34;&gt;= 1.6.0&#34;</span><span style="color:#719e07">}</span>,
</span></span><span style="display:flex;"><span> <span style="color:#719e07">{</span>:distillery, <span style="color:#2aa198">&#34;~&gt; 2.0&#34;</span>, warn_missing: false<span style="color:#719e07">}</span>,
</span></span></code></pre></td></tr></table>
</div>
</div><p>And add <code>:edeliver</code> to <code>extra_applications</code> in the <code>application</code> block:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>   def application <span style="color:#719e07">do</span>
</span></span><span style="display:flex;"><span>    <span style="color:#719e07">[</span>   
</span></span><span style="display:flex;"><span>      mod: <span style="color:#719e07">{</span>Fumigate.Application, <span style="color:#719e07">[]}</span>,
</span></span><span style="display:flex;"><span>      extra_applications: <span style="color:#719e07">[</span>:logger, :runtime_tools, :edeliver<span style="color:#719e07">]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#719e07">]</span>   
</span></span><span style="display:flex;"><span>  end 
</span></span></code></pre></td></tr></table>
</div>
</div><p>Use mix to install deps:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> mix deps.get
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="initialize-distillery">Initialize Distillery</h3>
<p>Distillery requires a build configuration file that is not generated by default.</p>
<p>Let‚Äôs generate it with:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> mix distillery.init
</span></span></code></pre></td></tr></table>
</div>
</div><p>This generates configuration files for Distillery in the <code>rel</code> directory. We don‚Äôt need to make any changes to the default config.</p>
<p>We now need to exclude <code>.deliver/releases/</code> from our git repo.</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#b58900">echo</span> <span style="color:#2aa198">&#34;.deliver/releases/&#34;</span> &gt;&gt; .gitignore
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="configure-edeliver">Configure edeliver</h3>
<p>Create a <code>.deliver</code> directory in your project folder and add the <code>config</code> file: (Change the IP to your server IP 134.209.8.141)</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">61
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#719e07">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#719e07"></span>
</span></span><span style="display:flex;"><span> <span style="color:#268bd2">APP</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;fumigate&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#268bd2">BUILD_HOST</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;134.209.8.141&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#268bd2">BUILD_USER</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;deploy&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#268bd2">BUILD_AT</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;/tmp/edeliver/</span><span style="color:#268bd2">$APP</span><span style="color:#2aa198">/builds&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#268bd2">START_DEPLOY</span><span style="color:#719e07">=</span><span style="color:#b58900">true</span>
</span></span><span style="display:flex;"><span> <span style="color:#268bd2">CLEAN_DEPLOY</span><span style="color:#719e07">=</span><span style="color:#b58900">true</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># prevent re-installing node modules; this defaults to &#34;.&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#268bd2">GIT_CLEAN_PATHS</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;_build rel priv/static&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#268bd2">PRODUCTION_HOSTS</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;134.209.8.141&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#268bd2">PRODUCTION_USER</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;deploy&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#268bd2">DELIVER_TO</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;/home/deploy/apps&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># For Phoenix projects, symlink prod.secret.exs to our tmp source</span>
</span></span><span style="display:flex;"><span> pre_erlang_get_and_update_deps<span style="color:#719e07">()</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>   <span style="color:#b58900">local</span> <span style="color:#268bd2">_prod_secret_path</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;/home/deploy/apps/</span><span style="color:#268bd2">$APP</span><span style="color:#2aa198">/secret/prod.secret.exs&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#719e07">if</span> <span style="color:#719e07">[</span> <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$TARGET_MIX_ENV</span><span style="color:#2aa198">&#34;</span> <span style="color:#719e07">=</span> <span style="color:#2aa198">&#34;prod&#34;</span> <span style="color:#719e07">]</span>; <span style="color:#719e07">then</span>
</span></span><span style="display:flex;"><span>     status <span style="color:#2aa198">&#34;Linking &#39;</span><span style="color:#268bd2">$_prod_secret_path</span><span style="color:#2aa198">&#39;&#34;</span>
</span></span><span style="display:flex;"><span>     __sync_remote <span style="color:#2aa198">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">       [ -f ~/.profile ] &amp;&amp; source ~/.profile
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">       mkdir -p &#39;</span><span style="color:#268bd2">$BUILD_AT</span><span style="color:#2aa198">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">       ln -sfn &#39;</span><span style="color:#268bd2">$_prod_secret_path</span><span style="color:#2aa198">&#39; &#39;</span><span style="color:#268bd2">$BUILD_AT</span><span style="color:#2aa198">/config/prod.secret.exs&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">     &#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#719e07">fi</span>
</span></span><span style="display:flex;"><span>    <span style="color:#719e07">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> pre_erlang_clean_compile<span style="color:#719e07">()</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>   status <span style="color:#2aa198">&#34;Running npm install&#34;</span>
</span></span><span style="display:flex;"><span>     __sync_remote <span style="color:#2aa198">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">       [ -f ~/.profile ] &amp;&amp; source ~/.profile
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">       set -e
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">       cd &#39;</span><span style="color:#268bd2">$BUILD_AT</span><span style="color:#2aa198">&#39;/assets
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">       npm install
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">     &#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   status <span style="color:#2aa198">&#34;Compiling assets&#34;</span>
</span></span><span style="display:flex;"><span>      __sync_remote <span style="color:#2aa198">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">       [ -f ~/.profile ] &amp;&amp; source ~/.profile
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">       set -e
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">       cd &#39;</span><span style="color:#268bd2">$BUILD_AT</span><span style="color:#2aa198">&#39;/assets
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">       node_modules/.bin/webpack --mode production --silent
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">     &#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   status <span style="color:#2aa198">&#34;Running phoenix.digest&#34;</span> <span style="color:#586e75"># log output prepended with &#34;-----&gt;&#34;</span>
</span></span><span style="display:flex;"><span>   __sync_remote <span style="color:#2aa198">&#34; # runs the commands on the build host
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">     [ -f ~/.profile ] &amp;&amp; source ~/.profile # load profile (optional)
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">     set -e # fail if any command fails (recommended)
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">     cd &#39;</span><span style="color:#268bd2">$BUILD_AT</span><span style="color:#2aa198">&#39; # enter the build directory on the build host (required)
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">          # prepare something
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">     mkdir -p priv/static # required by the phoenix.digest task
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">     # run your custom task
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">     APP=&#39;</span><span style="color:#268bd2">$APP</span><span style="color:#2aa198">&#39; MIX_ENV=&#39;</span><span style="color:#268bd2">$TARGET_MIX_ENV</span><span style="color:#2aa198">&#39; </span><span style="color:#268bd2">$MIX_CMD</span><span style="color:#2aa198"> phx.digest </span><span style="color:#268bd2">$SILENCE</span><span style="color:#2aa198">
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">     APP=&#39;</span><span style="color:#268bd2">$APP</span><span style="color:#2aa198">&#39; MIX_ENV=&#39;</span><span style="color:#268bd2">$TARGET_MIX_ENV</span><span style="color:#2aa198">&#39; </span><span style="color:#268bd2">$MIX_CMD</span><span style="color:#2aa198"> phx.digest.clean </span><span style="color:#268bd2">$SILENCE</span><span style="color:#2aa198">
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">   &#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#719e07">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>These are mostly environment variables use by Edeliver in the shell scripts. Go through them one by one and try to understand what they‚Äôre doing.</p>
<p>You can read more about the configuration variables in their <a class="link" href="https://github.com/edeliver/edeliver/wiki/Configuration-%28.deliver-config%29"  target="_blank" rel="noopener"
    >Wiki</a>.</p>
<p><em>Don‚Äôt forget to update your host configuration</em></p>
<p>The custom functions are hooks that run during different phases of the deployment.</p>
<p>You can also read more about running additional tasks in their <a class="link" href="https://github.com/edeliver/edeliver/wiki/Run-additional-build-tasks"  target="_blank" rel="noopener"
    >Wiki</a>.</p>
<h3 id="project-prod-configuration">Project prod configuration</h3>
<p>We‚Äôll need to make some changes to the default production configuration in our project.</p>
<p><strong>DO NOT RUN ON PORT 80. KEEP IT AT 4000.</strong> The application is running on deploy there fore it cannot run on port 80. We need to route incoming requests from 80 http and https to port 4000. Do not attempt to run app as root. That‚Äôs asking for trouble. Source: <a class="link" href="https://elixirforum.com/t/running-on-ec2-giving-error/13574/5"  target="_blank" rel="noopener"
    >https://elixirforum.com/t/running-on-ec2-giving-error/13574/5</a></p>
<p>Open <code>config/prod.exs</code> and update it to this:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">64
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>use Mix.Config
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>config :fumigate, FumigateWeb.Endpoint,
</span></span><span style="display:flex;"><span>   http: <span style="color:#719e07">[</span>:inet6, port: System.get_env<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;PORT&#34;</span><span style="color:#719e07">)</span> <span style="color:#719e07">||</span> 4000<span style="color:#719e07">]</span>,
</span></span><span style="display:flex;"><span>   url: <span style="color:#719e07">[</span>host: <span style="color:#2aa198">&#34;fumigatedb.com&#34;</span>, port: 80<span style="color:#719e07">]</span>,
</span></span><span style="display:flex;"><span>   cache_static_manifest: <span style="color:#2aa198">&#34;priv/static/cache_manifest.json&#34;</span>,
</span></span><span style="display:flex;"><span>   server: true,
</span></span><span style="display:flex;"><span>   code_reloader: <span style="color:#b58900">false</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># Do not print debug messages in production</span>
</span></span><span style="display:flex;"><span> config :logger, level: :info
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># ## SSL Support</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># To get SSL working, you will need to add the `https` key</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># to the previous section and set your `:url` port to 443:</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#     config :fumigate, FumigateWeb.Endpoint,</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#       ...</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#       url: [host: &#34;example.com&#34;, port: 443],</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#       https: [</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#         :inet6,</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#         port: 443,</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#         cipher_suite: :strong,</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#         keyfile: System.get_env(&#34;SOME_APP_SSL_KEY_PATH&#34;),</span>
</span></span><span style="display:flex;"><span><span style="color:#586e75">#         certfile: System.get_env(&#34;SOME_APP_SSL_CERT_PATH&#34;)</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#       ]</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># The `cipher_suite` is set to `:strong` to support only the</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># latest and more secure SSL ciphers. This means old browsers</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># and clients may not be supported. You can set it to</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># `:compatible` for wider support.</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># `:keyfile` and `:certfile` expect an absolute path to the key</span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># and cert in disk or a relative path inside priv, for example</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># &#34;priv/ssl/server.key&#34;. For all supported SSL configuration</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># options, see https://hexdocs.pm/plug/Plug.SSL.html#configure/1</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># We also recommend setting `force_ssl` in your endpoint, ensuring</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># no data is ever sent via http, always redirecting to https:</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#     config :fumigate, FumigateWeb.Endpoint,</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#       force_ssl: [hsts: true]</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># Check `Plug.SSL` for all available options in `force_ssl`.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># ## Using releases (distillery)</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># If you are doing OTP releases, you need to instruct Phoenix</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># to start the server for all endpoints:</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#</span>
</span></span><span style="display:flex;"><span> config :phoenix, :serve_endpoints, <span style="color:#b58900">true</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># Alternatively, you can configure exactly which server to</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># start per endpoint:</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#     config :fumigate, FumigateWeb.Endpoint, server: true</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># Note you can&#39;t rely on `System.get_env/1` when using releases.</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># See the releases documentation accordingly.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># Finally import the config/prod.secret.exs which should be versioned</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># separately.</span>
</span></span><span style="display:flex;"><span> import_config <span style="color:#2aa198">&#34;prod.secret.exs&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>These are settings recommended by Distillery. You might notice that we‚Äôre setting the system port using the <code>PORT</code> environment variable. This needs to be available during the build process and we can add it to the <code>~/.profile</code> file on our production server.</p>
<h3 id="add-env-variables-to-target-server">Add env Variables to Target Server</h3>
<p>Login as <code>deploy</code> to the target server.</p>
<p>Open up the <code>.profile</code>.</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#b58900">cd</span> ~
</span></span><span style="display:flex;"><span> vim ~/.profile
</span></span></code></pre></td></tr></table>
</div>
</div><p>And add these lines:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#b58900">export</span> <span style="color:#268bd2">MIX_ENV</span><span style="color:#719e07">=</span>prod
</span></span><span style="display:flex;"><span><span style="color:#b58900">export</span> <span style="color:#268bd2">PORT</span><span style="color:#719e07">=</span><span style="color:#2aa198">4000</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This will ensure that our system runs on port 4000, and that the environment is set to <code>prod</code>.</p>
<p>Logout of deploy and log back in for <code>~/.profile</code> be in effect.</p>
<h2 id="step-9-deployment">Step 9: Deployment</h2>
<p>We‚Äôre finally ready to build and deploy our first release. The default version is <code>0.1.0</code> so let‚Äôs just keep that for now.</p>
<p>Warning: the commands for building and deploy can seem complicated at first but once you become familiar with them, you will see that they use a natural language style.</p>
<h3 id="build-the-production-release">Build the production release:</h3>
<p><strong>NOTE:</strong> edeliver uses <code>git master branch</code> to build the code into release package.</p>
<p>In your project directory and git master branch:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> mix edeliver build release production --verbose
</span></span></code></pre></td></tr></table>
</div>
</div><p>This builds the release on the target server, and stores the archive in your local <code>.edeliver/releases</code> directory.</p>
<h3 id="deploy-the-reload-to-production">Deploy the reload to production:</h3>
<p>In your project directory:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> mix edeliver deploy release to production --verbose
</span></span><span style="display:flex;"><span> mix edeliver migrate production --verbose
</span></span><span style="display:flex;"><span> mix edeliver start production --verbose
</span></span></code></pre></td></tr></table>
</div>
</div><p>Other neat edeliver commands:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> mix edeliver ping production <span style="color:#586e75"># shows which nodes are up and running</span>
</span></span><span style="display:flex;"><span> mix edeliver version production <span style="color:#586e75"># shows the release version running on the nodes</span>
</span></span><span style="display:flex;"><span> mix edeliver show migrations on production <span style="color:#586e75"># shows pending database migrations</span>
</span></span><span style="display:flex;"><span> mix edeliver migrate production <span style="color:#586e75"># run database migrations</span>
</span></span><span style="display:flex;"><span> mix edeliver restart production <span style="color:#586e75"># or start or stop</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>You can read more about Edeliver in their <a class="link" href="https://github.com/edeliver/edeliver"  target="_blank" rel="noopener"
    >documentation</a>.</p>
<h3 id="view-our-website-on-our-server">View our website on our server</h3>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> ssh deploy@188.166.182.170
</span></span><span style="display:flex;"><span> curl localhost:4000
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="step-10-generating-ssl-cert---before-routing-incoming-http-request-to-port-4000-our-phoenix-app">Step 10: Generating SSL CERT - BEFORE Routing incoming http request to port 4000 (our phoenix app)</h2>
<p><a class="link" href="https://www.digitalocean.com/community/tutorials/how-to-use-certbot-standalone-mode-to-retrieve-let-s-encrypt-ssl-certificates-on-ubuntu-1804"  target="_blank" rel="noopener"
    >https://www.digitalocean.com/community/tutorials/how-to-use-certbot-standalone-mode-to-retrieve-let-s-encrypt-ssl-certificates-on-ubuntu-1804</a></p>
<p><a class="link" href="https://github.com/certbot/certbot/issues/5257"  target="_blank" rel="noopener"
    >https://github.com/certbot/certbot/issues/5257</a></p>
<p>We should generate SSL Certificate. The certbot generator needs port 80. So you need to do this before rerouting incoming port 80 requests to our phoenix web app that‚Äôs listening on port 4000.</p>
<h3 id="step-1--installing-certbot">Step 1 ‚Äî Installing Certbot</h3>
<p>The first step to using Let‚Äôs Encrypt to obtain an SSL certificate is to install the Certbot software on your server.</p>
<p>Certbot is in very active development, so the Certbot packages provided by Ubuntu tend to be outdated. However, the Certbot developers maintain a Ubuntu software repository with up-to-date versions, so we‚Äôll use that repository instead.</p>
<p>First, add the repository:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> sudo add-apt-repository ppa:certbot/certbot
</span></span><span style="display:flex;"><span> apt-get update
</span></span></code></pre></td></tr></table>
</div>
</div><p>Install certbot:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> sudo apt-get install certbot
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="step-2--generating-certificate">Step 2 ‚Äî Generating Certificate</h3>
<p>Make sure that your firewall is accepting port 80.</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> sudo ufw allow <span style="color:#2aa198">80</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Generate the SSL cert:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> sudo certbot certonly --standalone --preferred-challenges http -d fumigatedb.com -d www.fumigatedb.com
</span></span></code></pre></td></tr></table>
</div>
</div><p>Enable it so deploy user and app own by deploy can read those certs:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> chmod <span style="color:#2aa198">755</span> /etc/letsencrypt/live/
</span></span><span style="display:flex;"><span> chmod <span style="color:#2aa198">755</span> /etc/letsencrypt/archive/
</span></span></code></pre></td></tr></table>
</div>
</div><p>We‚Äôll get back to using cert on the server soon in step 13.</p>
<h2 id="step-11-routing-incoming-http-request-to-port-4000-our-phoenix-app">Step 11: Routing incoming http request to port 4000 (our phoenix app)</h2>
<p><a class="link" href="https://serverfault.com/questions/238563/can-i-use-ufw-to-setup-a-port-forward"  target="_blank" rel="noopener"
    >https://serverfault.com/questions/238563/can-i-use-ufw-to-setup-a-port-forward</a></p>
<p>Let‚Äôs say you want to forward requests going to 80 (http) to a server listening on port 4000.</p>
<p>Note that you will need to make sure port 8080 is allowed, otherwise ufw will block the requests that are redirected to 4000.</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> sudo ufw allow 4000/tcp
</span></span></code></pre></td></tr></table>
</div>
</div><p>There are no ufw commands for setting up the port forwards, so it must be done via configuraton files. Add the lines below to <code>/etc/ufw/before.rules</code>, before the <code>filter</code> section, right at the top of the file:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>  sudo vim /etc/ufw/before.rules
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> *nat
</span></span><span style="display:flex;"><span> :PREROUTING ACCEPT <span style="color:#719e07">[</span>0:0<span style="color:#719e07">]</span>
</span></span><span style="display:flex;"><span> -A PREROUTING -p tcp --dport <span style="color:#2aa198">80</span> -j REDIRECT --to-port <span style="color:#2aa198">4000</span>
</span></span><span style="display:flex;"><span> COMMIT
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then restart the server:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> sudo reboot
</span></span><span style="display:flex;"><span> ssh deploy@134.209.8.141
</span></span></code></pre></td></tr></table>
</div>
</div><p>Enable ufw to start on boot:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> sudo ufw <span style="color:#b58900">enable</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>Debug tips</em>: check <code>/var/log/syslog</code></p>
<h2 id="step-12-fail2ban">Step 12: Fail2ban</h2>
<p><a class="link" href="https://www.lifewire.com/harden-ubuntu-server-security-4178243"  target="_blank" rel="noopener"
    >https://www.lifewire.com/harden-ubuntu-server-security-4178243</a></p>
<p><a class="link" href="https://www.techrepublic.com/article/how-to-install-fail2ban-on-ubuntu-server-18-04/"  target="_blank" rel="noopener"
    >https://www.techrepublic.com/article/how-to-install-fail2ban-on-ubuntu-server-18-04/</a></p>
<p>The fail2ban system is an intrusion prevention system that monitors log files and searches for particular patterns that correspond to a failed login attempt. If a certain number of failed logins are detected from a specific IP address (within a specified amount of time), fail2ban will block access from that IP address.</p>
<p>To install fail2ban, open a terminal window and issue the command:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> sudo apt-get update
</span></span><span style="display:flex;"><span> sudo apt-get upgrade
</span></span><span style="display:flex;"><span> sudo apt-get install -y fail2ban
</span></span></code></pre></td></tr></table>
</div>
</div><p>Within the directory <code>/etc/fail2ban</code>, you‚Äôll find the main configuration file, jail.conf. Also in that directory is the subdirectory, jail.d. The jail.conf file is the main configuration file and jail.d contains the secondary configuration files. Do not edit the jail.conf file. Instead, we‚Äôll create a new configuration that will monitor SSH logins with the command:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> sudo vim /etc/fail2ban/jail.local
</span></span></code></pre></td></tr></table>
</div>
</div><p>In this new file add the following contents:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#719e07">[</span>sshd<span style="color:#719e07">]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">enabled</span> <span style="color:#719e07">=</span> <span style="color:#b58900">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">port</span> <span style="color:#719e07">=</span> <span style="color:#2aa198">22</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">filter</span> <span style="color:#719e07">=</span> sshd
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">logpath</span> <span style="color:#719e07">=</span> /var/log/auth.log
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">maxretry</span> <span style="color:#719e07">=</span> <span style="color:#2aa198">3</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This configuration does the following:</p>
<ul>
<li>Enables the jail.</li>
<li>Sets the SSH port to be monitored to 22.</li>
<li>Uses the sshd filter.</li>
<li>Sets the log file to be monitored.</li>
</ul>
<p>Save and close that file. Restart fail2ban with the command:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> sudo systemctl start fail2ban
</span></span><span style="display:flex;"><span> sudo systemctl <span style="color:#b58900">enable</span> fail2ban
</span></span><span style="display:flex;"><span> sudo systemctl restart fail2ban
</span></span></code></pre></td></tr></table>
</div>
</div><p>If you attempt to Secure Shell into that server and fail the log in three times (set as the default by fail2ban), access will be then blocked from the <a class="link" href="https://www.lifewire.com/what-is-an-ip-address-2625920"  target="_blank" rel="noopener"
    >IP address</a> you are working from.</p>
<h3 id="testing-and-unbanning">Testing and unbanning</h3>
<p>You can test to make sure the new jail works by failing three attempts at logging into the server, via ssh. After the third failed attempt, the connection will hang. Hit <code>[Ctrl]+[c]</code> to escape and then attempt to SSH back into the server. You should no longer be able to SSH into that server from the IP address you were using.</p>
<p>You can then unban your test IP address with the following command:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> sudo fail2ban-client <span style="color:#b58900">set</span> sshd unbanip IP_ADDRESS
</span></span></code></pre></td></tr></table>
</div>
</div><p>where <code>IP_ADDRESS</code> is the banned IP Address.</p>
<p>You should now be able to log back into the server with SSH.</p>
<h3 id="scratching-the-surface">Scratching the surface</h3>
<p>This barely scratches the surface as to what fail2ban can do. But now you have a good idea on how to use the system. To find out more, make sure to read the man page with the command:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> man fail2ban
</span></span></code></pre></td></tr></table>
</div>
</div><p>That manual page provides a good overview of what fail2ban can do.</p>
<h2 id="step-13-port-foward-ssl-to-port-4001">Step 13: Port foward SSL to Port 4001</h2>
<p>Set up the firewall:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> sudo ufw allow https
</span></span><span style="display:flex;"><span> sudo ufw allow <span style="color:#2aa198">443</span>
</span></span><span style="display:flex;"><span> sudo ufw allow <span style="color:#2aa198">4001</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>There are no ufw commands for setting up the port forwards, so it must be done via configuraton files. Add the lines below to <code>/etc/ufw/before.rules</code>, before the <code>filter</code> section, right at the top of the file:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> sudo vim /etc/ufw/before.rules
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> *nat
</span></span><span style="display:flex;"><span> :PREROUTING ACCEPT <span style="color:#719e07">[</span>0:0<span style="color:#719e07">]</span>
</span></span><span style="display:flex;"><span> -A PREROUTING -p tcp --dport <span style="color:#2aa198">443</span> -j REDIRECT --to-port <span style="color:#2aa198">4001</span>
</span></span><span style="display:flex;"><span> COMMIT
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then restart the server:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> sudo ufw <span style="color:#b58900">enable</span>
</span></span><span style="display:flex;"><span> sudo reboot
</span></span><span style="display:flex;"><span> ssh deploy@134.209.8.141
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="step-14-ssl">Step 14: SSL</h2>
<p><a class="link" href="https://blog.progressplum.app/ssl-migration-from-nginx-to-cowboy-2-in-phoenix-1-4/"  target="_blank" rel="noopener"
    >https://blog.progressplum.app/ssl-migration-from-nginx-to-cowboy-2-in-phoenix-1-4/</a></p>
<p><a class="link" href="https://medium.com/@zek/secure-your-phoenix-app-with-free-ssl-48ac749c17d7"  target="_blank" rel="noopener"
    >https://medium.com/@zek/secure-your-phoenix-app-with-free-ssl-48ac749c17d7</a></p>
<h3 id="step-1--generating-diffie-hellman-parameters">Step 1 ‚Äî Generating Diffie Hellman parameters</h3>
<p>If you don‚Äôt already have a set of Diffie Hellman parameters[2] to use with your SSL, generate a new set for extra security. Run this command on the server but be aware that it‚Äôs very CPU-intensive and may take a while on a slow VPS.</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> openssl dhparam -out /etc/letsencrypt/dhparam.pem <span style="color:#2aa198">4096</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="step-2--set-up-your-environment">Step 2 ‚Äî Set up your environment</h3>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> sudo vim ~/.profile
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#b58900">export</span> <span style="color:#268bd2">MIX_ENV</span><span style="color:#719e07">=</span>prod
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#b58900">export</span> <span style="color:#268bd2">PORT</span><span style="color:#719e07">=</span><span style="color:#2aa198">4000</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#b58900">export</span> <span style="color:#268bd2">SPORT</span><span style="color:#719e07">=</span><span style="color:#2aa198">4001</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#b58900">export</span> <span style="color:#268bd2">SSL_CERT_FILE</span><span style="color:#719e07">=</span>/etc/letsencrypt/live/fumigatedb.com/cert.pem
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#b58900">export</span> <span style="color:#268bd2">SSL_CACERT_FILE</span><span style="color:#719e07">=</span>/etc/letsencrypt/live/fumigatedb.com/chain.pem
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#b58900">export</span> <span style="color:#268bd2">SSL_KEY_FILE</span><span style="color:#719e07">=</span>/etc/letsencrypt/live/fumigatedb.com/privkey.pem
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#b58900">export</span> <span style="color:#268bd2">SSL_DHPARAM_FILE</span><span style="color:#719e07">=</span>/etc/letsencrypt/dhparam.pem
</span></span></code></pre></td></tr></table>
</div>
</div><p>Change <code>fumigatedb.com</code> to your domainname.</p>
<h3 id="step-3--prod-configuration">Step 3 ‚Äî prod Configuration</h3>
<p>Update your application‚Äôs Endpoint configuration to add SSL support in <code>config/prod.exs</code>.</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> vim config/prod.exs
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>config :fumigate, FumigateWeb.Endpoint,
</span></span><span style="display:flex;"><span>       url: <span style="color:#719e07">[</span>scheme: <span style="color:#2aa198">&#34;https&#34;</span>, host: <span style="color:#2aa198">&#34;fumigatedb.com&#34;</span>, port: 443<span style="color:#719e07">]</span>,
</span></span><span style="display:flex;"><span>       http: <span style="color:#719e07">[</span>:inet6, port: System.get_env<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;PORT&#34;</span><span style="color:#719e07">)</span> <span style="color:#719e07">||</span> 4000<span style="color:#719e07">]</span>,
</span></span><span style="display:flex;"><span>       https: <span style="color:#719e07">[</span>
</span></span><span style="display:flex;"><span>           :inet6,
</span></span><span style="display:flex;"><span>           port: System.get<span style="color:#cb4b16">\_</span>env<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;SPORT&#34;</span><span style="color:#719e07">)</span> <span style="color:#719e07">||</span> 4001,
</span></span><span style="display:flex;"><span>           otp_app: :fumigate,
</span></span><span style="display:flex;"><span>           cipher_suite: :strong,
</span></span><span style="display:flex;"><span>           keyfile: System.get_env<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;SSL_KEY_FILE&#34;</span><span style="color:#719e07">)</span>,
</span></span><span style="display:flex;"><span>           certfile: System.get_env<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;SSL_CERT_FILE&#34;</span><span style="color:#719e07">)</span>,
</span></span><span style="display:flex;"><span>           cacertfile: System.get_env<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;SSL_CACERT_FILE&#34;</span><span style="color:#719e07">)</span>,
</span></span><span style="display:flex;"><span>           dhfile: System.get_env<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;SSL_DHPARAM_FILE&#34;</span><span style="color:#719e07">)</span>
</span></span><span style="display:flex;"><span>       <span style="color:#719e07">]</span>,
</span></span><span style="display:flex;"><span>       cache_static_manifest: <span style="color:#2aa198">&#34;priv/static/cache_manifest.json&#34;</span>,
</span></span><span style="display:flex;"><span>       server: true,
</span></span><span style="display:flex;"><span>       code_reloader: <span style="color:#b58900">false</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Save to git master repo and rerun edeliver again.</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> git commit -a -m <span style="color:#2aa198">&#34;edited prod.exs to add HTTPS scheme&#34;</span>
</span></span><span style="display:flex;"><span> git push origin master
</span></span><span style="display:flex;"><span> mix edeliver build release production --verbose
</span></span><span style="display:flex;"><span> mix edeliver deploy release to production
</span></span><span style="display:flex;"><span> mix edeliver stop production
</span></span><span style="display:flex;"><span> mix edeliver start production
</span></span></code></pre></td></tr></table>
</div>
</div><p>Check the ssl website now with: <a class="link" href="https://www.ssllabs.com/ssltest/"  target="_blank" rel="noopener"
    >https://www.ssllabs.com/ssltest/</a></p>
<h3 id="step-4--application-configuration-forcing-ssl">Step 4 ‚Äî Application Configuration forcing SSL</h3>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> git commit -a -m <span style="color:#2aa198">&#34;edited prod.exs to force SSL connection&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> git push origin master
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> mix edeliver build release production --verbose
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> mix edeliver deploy release to production
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> mix edeliver stop production
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> mix edeliver start production
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="step-5--increasing-the-security-of-ssl">Step 5 ‚Äî Increasing the security of SSL</h3>
<p><a class="link" href="https://elixirforum.com/t/making-ssl-tests-all-pass-for-phoenix-lets-encrypt/3507/11"  target="_blank" rel="noopener"
    >https://elixirforum.com/t/making-ssl-tests-all-pass-for-phoenix-lets-encrypt/3507/11</a></p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">133
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>use Mix.Config
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># For production, don&#39;t forget to configure the url host</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># to something meaningful, Phoenix uses this information</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># when generating URLs.</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># Note we also include the path to a cache manifest</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># containing the digested version of static files. This</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># manifest is generated by the `mix phx.digest` task,</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># which you should run after static files are built and</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># before starting your production server.</span>
</span></span><span style="display:flex;"><span> config :fumigate, FumigateWeb.Endpoint,
</span></span><span style="display:flex;"><span>   url: <span style="color:#719e07">[</span>scheme: <span style="color:#2aa198">&#34;https&#34;</span>, host: <span style="color:#2aa198">&#34;fumigatedb.com&#34;</span>, port: 443<span style="color:#719e07">]</span>,
</span></span><span style="display:flex;"><span>   force_ssl: <span style="color:#719e07">[</span>hsts: true<span style="color:#719e07">]</span>,
</span></span><span style="display:flex;"><span>   http: <span style="color:#719e07">[</span>:inet6, port: System.get_env<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;PORT&#34;</span><span style="color:#719e07">)</span> <span style="color:#719e07">||</span> 4000<span style="color:#719e07">]</span>,
</span></span><span style="display:flex;"><span>   https: <span style="color:#719e07">[</span>
</span></span><span style="display:flex;"><span>        :inet6,
</span></span><span style="display:flex;"><span>     port: System.get_env<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;SPORT&#34;</span><span style="color:#719e07">)</span> <span style="color:#719e07">||</span> 4001,
</span></span><span style="display:flex;"><span>     otp_app: :fumigate,
</span></span><span style="display:flex;"><span>     cipher_suite: :strong,
</span></span><span style="display:flex;"><span>     keyfile: System.get_env<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;SSL_KEY_FILE&#34;</span><span style="color:#719e07">)</span>,
</span></span><span style="display:flex;"><span>     certfile: System.get_env<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;SSL_CERT_FILE&#34;</span><span style="color:#719e07">)</span>,
</span></span><span style="display:flex;"><span>     cacertfile: System.get_env<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;SSL_CACERT_FILE&#34;</span><span style="color:#719e07">)</span>,
</span></span><span style="display:flex;"><span>     dhfile: System.get_env<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;SSL_DHPARAM_FILE&#34;</span><span style="color:#719e07">)</span>,
</span></span><span style="display:flex;"><span>     versions: <span style="color:#719e07">[</span>:<span style="color:#2aa198">&#34;tlsv1.2&#34;</span>, :<span style="color:#2aa198">&#34;tlsv1.1&#34;</span>, :<span style="color:#2aa198">&#34;tlsv1&#34;</span><span style="color:#719e07">]</span>,
</span></span><span style="display:flex;"><span>           ciphers: ~w<span style="color:#719e07">(</span>
</span></span><span style="display:flex;"><span>             ECDHE-ECDSA-AES256-GCM-SHA384
</span></span><span style="display:flex;"><span>             ECDHE-ECDSA-AES256-SHA384
</span></span><span style="display:flex;"><span>             ECDHE-ECDSA-AES128-GCM-SHA256
</span></span><span style="display:flex;"><span>             ECDHE-ECDSA-AES128-SHA256
</span></span><span style="display:flex;"><span>             ECDHE-ECDSA-AES256-SHA
</span></span><span style="display:flex;"><span>             ECDHE-ECDSA-AES128-SHA
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>             ECDHE-RSA-AES256-GCM-SHA384
</span></span><span style="display:flex;"><span>             ECDHE-RSA-AES256-SHA384
</span></span><span style="display:flex;"><span>             ECDHE-RSA-AES128-GCM-SHA256
</span></span><span style="display:flex;"><span>             ECDHE-RSA-AES128-SHA256
</span></span><span style="display:flex;"><span>             ECDHE-RSA-AES256-SHA
</span></span><span style="display:flex;"><span>             ECDHE-RSA-AES128-SHA
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>             ECDH-ECDSA-AES256-GCM-SHA384
</span></span><span style="display:flex;"><span>             ECDH-ECDSA-AES256-SHA384
</span></span><span style="display:flex;"><span>             ECDH-ECDSA-AES128-GCM-SHA256
</span></span><span style="display:flex;"><span>             ECDH-ECDSA-AES128-SHA256
</span></span><span style="display:flex;"><span>             
</span></span><span style="display:flex;"><span>             
</span></span><span style="display:flex;"><span>             DHE-RSA-AES256-GCM-SHA384
</span></span><span style="display:flex;"><span>             DHE-RSA-AES256-SHA256
</span></span><span style="display:flex;"><span>             DHE-DSS-AES256-GCM-SHA384
</span></span><span style="display:flex;"><span>             DHE-DSS-AES256-SHA256
</span></span><span style="display:flex;"><span>             DHE-RSA-AES256-SHA
</span></span><span style="display:flex;"><span>             DHE-DSS-AES256-SHA
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>             DHE-DSS-AES128-GCM-SHA256
</span></span><span style="display:flex;"><span>             DHE-RSA-AES128-GCM-SHA256
</span></span><span style="display:flex;"><span>             DHE-RSA-AES128-SHA256
</span></span><span style="display:flex;"><span>             DHE-DSS-AES128-SHA256
</span></span><span style="display:flex;"><span>             DHE-RSA-AES128-SHA
</span></span><span style="display:flex;"><span>             DHE-DSS-AES128-SHA
</span></span><span style="display:flex;"><span>             
</span></span><span style="display:flex;"><span>             
</span></span><span style="display:flex;"><span>             AES128-GCM-SHA256
</span></span><span style="display:flex;"><span>             AES128-SHA
</span></span><span style="display:flex;"><span>             DES-CBC3-SHA
</span></span><span style="display:flex;"><span>           <span style="color:#719e07">)</span>c,
</span></span><span style="display:flex;"><span>           secure_renegotiate: true,
</span></span><span style="display:flex;"><span>           reuse_sessions: true,
</span></span><span style="display:flex;"><span>           honor_cipher_order: true,
</span></span><span style="display:flex;"><span>           client_renegotiation: false,
</span></span><span style="display:flex;"><span>           eccs: <span style="color:#719e07">[</span>
</span></span><span style="display:flex;"><span>             :sect571r1, :sect571k1, :secp521r1, :brainpoolP512r1, :sect409k1,
</span></span><span style="display:flex;"><span>             :sect409r1, :brainpoolP384r1, :secp384r1, :sect283k1, :sect283r1,
</span></span><span style="display:flex;"><span>             :brainpoolP256r1, :secp256k1, :secp256r1, :sect239k1, :sect233k1,
</span></span><span style="display:flex;"><span>             :sect233r1, :secp224k1, :secp224r1
</span></span><span style="display:flex;"><span>           <span style="color:#719e07">]</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#719e07">]</span>,
</span></span><span style="display:flex;"><span>   cache_static_manifest: <span style="color:#2aa198">&#34;priv/static/cache_manifest.json&#34;</span>,
</span></span><span style="display:flex;"><span>   server: true,
</span></span><span style="display:flex;"><span>   code_reloader: <span style="color:#b58900">false</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># Do not print debug messages in production</span>
</span></span><span style="display:flex;"><span> config :logger, level: :info
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># ## SSL Support</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># To get SSL working, you will need to add the `https` key</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># to the previous section and set your `:url` port to 443:</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#     config :fumigate, FumigateWeb.Endpoint,</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#       ...</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#       url: [host: &#34;example.com&#34;, port: 443],</span>
</span></span><span style="display:flex;"><span>  <span style="color:#586e75">#       https: [</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#         :inet6,</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#         port: 443,</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#         cipher_suite: :strong,</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#         keyfile: System.get_env(&#34;SOME_APP_SSL_KEY_PATH&#34;),</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#         certfile: System.get_env(&#34;SOME_APP_SSL_CERT_PATH&#34;)</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#       ]</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># The `cipher_suite` is set to `:strong` to support only the</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># latest and more secure SSL ciphers. This means old browsers</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># and clients may not be supported. You can set it to</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># `:compatible` for wider support.</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># `:keyfile` and `:certfile` expect an absolute path to the key</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># and cert in disk or a relative path inside priv, for example</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># &#34;priv/ssl/server.key&#34;. For all supported SSL configuration</span>
</span></span><span style="display:flex;"><span>  <span style="color:#586e75"># options, see https://hexdocs.pm/plug/Plug.SSL.html#configure/1</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># We also recommend setting `force_ssl` in your endpoint, ensuring</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># no data is ever sent via http, always redirecting to https:</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># Check `Plug.SSL` for all available options in `force_ssl`.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># ## Using releases (distillery)</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># If you are doing OTP releases, you need to instruct Phoenix</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># to start the server for all endpoints:</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#</span>
</span></span><span style="display:flex;"><span> config :phoenix, :serve_endpoints, <span style="color:#b58900">true</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># Alternatively, you can configure exactly which server to</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># start per endpoint:</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#     config :fumigate, FumigateWeb.Endpoint, server: true</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75">#</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># Note you can&#39;t rely on `System.get_env/1` when using releases.</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># See the releases documentation accordingly.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># Finally import the config/prod.secret.exs which should be versioned</span>
</span></span><span style="display:flex;"><span> <span style="color:#586e75"># separately.</span>
</span></span><span style="display:flex;"><span> import_config <span style="color:#2aa198">&#34;prod.secret.exs&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="credit">Credit</h2>
<h3 id="base-on-these-resources">Base on these resources:</h3>
<ol>
<li><a class="link" href="https://devato.com/automate-elixir-phoenix-1-4-deployment-with-distillery-and-edeliver-on-ubuntu/#step-6-target-server-install-nodejs"  target="_blank" rel="noopener"
    >https://devato.com/automate-elixir-phoenix-1-4-deployment-with-distillery-and-edeliver-on-ubuntu/#step-6-target-server-install-nodejs</a></li>
<li><a class="link" href="https://medium.com/@zek/deploy-early-and-often-deploying-phoenix-with-edeliver-and-distillery-part-one-5e91cac8d4bd"  target="_blank" rel="noopener"
    >https://medium.com/@zek/deploy-early-and-often-deploying-phoenix-with-edeliver-and-distillery-part-one-5e91cac8d4bd</a></li>
<li><a class="link" href="https://medium.com/@zek/deploy-early-and-often-deploying-phoenix-with-edeliver-and-distillery-part-two-f361ef36aa10"  target="_blank" rel="noopener"
    >https://medium.com/@zek/deploy-early-and-often-deploying-phoenix-with-edeliver-and-distillery-part-two-f361ef36aa10</a></li>
<li><a class="link" href="https://blog.progressplum.app/ssl-migration-from-nginx-to-cowboy-2-in-phoenix-1-4/"  target="_blank" rel="noopener"
    >https://blog.progressplum.app/ssl-migration-from-nginx-to-cowboy-2-in-phoenix-1-4/</a></li>
<li><a class="link" href="https://elixirforum.com/t/elixir-1-9-releases-with-edeliver/23728/3?u=mythicalprogrammer"  target="_blank" rel="noopener"
    >https://elixirforum.com/t/elixir-1-9-releases-with-edeliver/23728/3?u=mythicalprogrammer</a></li>
</ol>
<h3 id="pictures">Pictures</h3>
<ol>
<li>First picture: <a class="link" href="https://pixabay.com/illustrations/color-phoenix-tradition-legend-1544543/"  target="_blank" rel="noopener"
    >Color Phoenix Tradition</a></li>
</ol>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/elixir/">Elixir</a>
        
            <a href="/tags/phoenix/">Phoenix</a>
        
            <a href="/tags/webdev/">webdev</a>
        
            <a href="/tags/deployment/">deployment</a>
        
            <a href="/tags/distillery/">distillery</a>
        
            <a href="/tags/edeliver/">edeliver</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/p/my-web-stack-in-the-year-2023-and-the-future/">
        
        
            <div class="article-image">
                <img src="/p/my-web-stack-in-the-year-2023-and-the-future/_hu2ae759ce12b03dce750ac36f7d6b378c_337571_950a4592fcd07cb3c5a838bb15c126e0.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post My Web Stack in the year 2023 and the future"
                        data-key="my-web-stack-in-the-year-2023-and-the-future" 
                        data-hash="md5-SItPB/W/a&#43;41IQ/JIEY9bw==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">My Web Stack in the year 2023 and the future</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/phoenix-v1-7-14-views-components-and-how-it-is-different-from-other-mvc-frameworks/">
        
        
            <div class="article-image">
                <img src="/p/phoenix-v1-7-14-views-components-and-how-it-is-different-from-other-mvc-frameworks/_hu3ed2371e628725aa6bc25e07c85826b2_263412_9830746948f64f404964d36b510659ad.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post Phoenix v1.7.14 Views (components) and how it is different from other MVC frameworks"
                        data-key="phoenix-v1-7-14-views-components-and-how-it-is-different-from-other-mvc-frameworks" 
                        data-hash="md5-6YCbIAUxe8S9aGicHFmbFg==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Phoenix v1.7.14 Views (components) and how it is different from other MVC frameworks</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/the-case-for-boring-technology/">
        
        
            <div class="article-image">
                <img src="/p/the-case-for-boring-technology/bored-3082828_1920.8d155e4bc33a13340c65ffa1cd922023_hua3f227cc1dad48243028196a49fdfc22_223249_250x150_fill_q75_box_smart1.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post The Case for Boring Technology"
                        data-key="the-case-for-boring-technology" 
                        data-hash="md5-jRVeS8M6EzQMZf&#43;hzZIgIw==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">The Case for Boring Technology</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/book-review-learning-php-mysql-and-javascript/">
        
        
            <div class="article-image">
                <img src="/p/book-review-learning-php-mysql-and-javascript/lrg.387e8a653d93917b78c310611afba410_hu6175601c20069418e0467d5bd0e815e7_73566_250x150_fill_q75_box_smart1.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post Book Review: Learning PHP, MySQL, and JavaScript: A Step-By-Step Guide to Creating Dynamic Websites (Animal Guide)"
                        data-key="book-review-learning-php-mysql-and-javascript" 
                        data-hash="md5-OH6KZT2TkXt4wxBhGvukEA==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Book Review: Learning PHP, MySQL, and JavaScript: A Step-By-Step Guide to Creating Dynamic Websites (Animal Guide)</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/finding-a-good-php-ide-eclipse-pdt/">
        
        
            <div class="article-image">
                <img src="/p/finding-a-good-php-ide-eclipse-pdt/archway-6915701_1280.b285cee551d8e4243c6f7fd3ae1f1fdb_hua59ebd0fb34f35215d7a7f4ce42f3c3f_259565_250x150_fill_q75_box_smart1.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post Finding a good PHP IDE - Eclipse &#43; PDT"
                        data-key="finding-a-good-php-ide-eclipse-pdt" 
                        data-hash="md5-soXO5VHY5CQ8b3/Trh8f2w==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Finding a good PHP IDE - Eclipse &#43; PDT</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "hugo-theme-stack" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (typeof DISQUS == 'object') {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2009 - 
        
        2025 Anthony Quoc Anh Doan - Ramblings of a Happy Scientist
        
    </section>
    
    <section>
      <p align="center">Desiderata by Max Ehrmann</p>
      <p>
          Go placidly amid the noise and the haste, and remember what peace there may be in silence. As far as possible without surrender be on good terms with all persons. Speak your truth quietly and clearly; and listen to others, even to the dull and the ignorant, they too have their story. Avoid loud and aggressive persons, they are vexations to the spirit.
      </p>

      <p>
    If you compare yourself with others, you may become vain or bitter; for always there will be greater and lesser persons than yourself. Enjoy your achievements as well as your plans. Keep interested in your own career, however humble; it is a real possession in the changing fortunes of time.
      </p>

      <p>
    Exercise caution in your business affairs, for the world is full of trickery. But let not this blind you to what virtue there is; many persons strive for high ideals, and everywhere life is full of heroism. Be yourself. Especially do not feign affection. Neither be cynical about love; for in the face of all aridity and disenchantment it is as perennial as the grass. Take kindly the counsel of the years, gracefully surrendering the things of youth.
      </p>

      <p>
    Nurture strength of spirit to shield you in sudden misfortune. But do not distress yourself with dark imaginings. Many fears are born of fatigue and loneliness. Beyond a wholesome discipline, be gentle with yourself. You are a child of the universe, no less than the trees and the stars; you have a right to be here. And whether or not it is clear to you, no doubt the universe is unfolding as it should.
      </p>

      <p>
    Therefore, be at peace with God, whatever you conceive Him to be. And whatever your labors and aspirations in the noisy confusion of life, keep peace in your soul. With all its sham, drudgery and broken dreams; it is still a beautiful world. Be cheerful.
      </p>

      <p>
    Strive to be happy.
      </p>
      
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.17.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
